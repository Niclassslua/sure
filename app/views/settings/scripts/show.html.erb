<%= content_for :page_title, t(".page_title") %>

<%= settings_section title: t(".section_title") do %>
  <div class="space-y-6">
    <%= form_with url: settings_script_path, method: :get, local: true do |f| %>
      <div class="space-y-2">
        <%= f.label :account_id, t(".account_label"), class: "block text-sm" %>
        <%= f.collection_select :account_id, @accounts, :id, :name, { prompt: t(".select_account") }, { class: "w-full" } %>
      </div>
      <div class="mt-4">
        <%= f.submit t(".choose"), class: "px-4 py-2 border rounded-lg" %>
      </div>
    <% end %>

    <% if @account %>
      <%= form_with url: settings_script_path, method: :put, multipart: true, local: true do |f| %>
        <%= hidden_field_tag :account_id, @account.id %>
        <div class="space-y-2">
          <%= f.label :script, t(".script_label"), class: "block text-sm" %>
          <%= f.file_field :script, accept: ".py" %>
        </div>
        <div class="mt-4">
          <%= f.submit t(".upload"), class: "px-4 py-2 border rounded-lg" %>
        </div>
      <% end %>

      <% if @script_contents.present? %>
        <div>
          <h3 class="text-sm font-medium mb-2"><%= t(".current_script") %></h3>
          <pre class="bg-surface-inset p-4 rounded text-xs whitespace-pre-wrap"><%= @script_contents %></pre>
        </div>
      <% end %>
    <% end %>
  </div>
<% end %>
