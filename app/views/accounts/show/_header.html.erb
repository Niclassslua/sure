<%# locals: (account:, title:, subtitle: nil) %>

<header class="space-y-4">
  <div class="flex items-center gap-4">
    <div class="flex items-center gap-3 overflow-hidden">
      <%= render "accounts/logo", account: account %>

      <div class="flex items-center gap-2">
        <div class="truncate">
          <div class="flex items-center gap-3">
            <h2 class="font-medium text-xl truncate <%= "animate-pulse" if account.syncing? %>"><%= title %></h2>
            <% if account.draft? %>
              <%= render DS::Link.new(
                  text: "Complete setup",
                  href: edit_account_path(account),
                  variant: :outline,
                  size: :sm,
                  frame: :modal
                ) %>
            <% end %>
          </div>
          <% if subtitle.present? %>
            <p class="text-sm text-secondary"><%= subtitle %></p>
          <% end %>
        </div>
      </div>
    </div>

    <div class="flex items-center gap-1 ml-auto">
      <% if Rails.env.development? || self_hosted? %>
        <%= icon(
            "refresh-cw",
            as_button: true,
            size: "sm",
            href: account.linked? ? sync_plaid_item_path(account.plaid_account.plaid_item) : sync_account_path(account),
            disabled: account.syncing?,
            frame: :_top,
            aria: { label: "Synchronisieren" }
          ) %>

        <% if account.fints_api_base_url.present? %>
          <%= link_to fetch_fints_account_path(account), 
              class: "inline-flex items-center gap-2 rounded-md px-3 py-2 text-sm font-medium bg-gray-50 hover:bg-gray-100 dark:bg-gray-800 dark:hover:bg-gray-700 text-gray-900 dark:text-gray-100 shadow-sm",
              "aria-label": "Fints-Konto abrufen",
              "data-frame": "modal",
              "aria-disabled": account.syncing? do %>
            <!-- Download / Daten holen Icon -->
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M12 3v12m0 0l-4-4m4 4l4-4" />
              <path d="M5 18h14" />
            </svg>
            <span>Daten holen</span>
          <% end %>
        <% end %>
      <% end %>

      <%= render "accounts/show/menu", account: account %>
    </div>
  </div>
</header>